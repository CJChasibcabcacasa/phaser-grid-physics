!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("AnimatedTiles",[],t):"object"==typeof exports?exports.AnimatedTiles=t():e.AnimatedTiles=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){n(this,e),this.scene=t,this.systems=t.sys,this.map=null,this.animatedTiles=[],this.rate=1,this.active=!1,this.activeLayer=[],this.followTimeScale=!0,t.sys.settings.isBooted||t.sys.events.once("boot",this.boot,this)}return a(e,[{key:"boot",value:function(){var e=this.systems.events;e.on("postupdate",this.postUpdate,this),e.on("shutdown",this.shutdown,this),e.on("destroy",this.destroy,this)}},{key:"init",value:function(e){var t=this.getAnimatedTiles(e),i={map:e,animatedTiles:t,active:!0,rate:1,activeLayer:[]};e.layers.forEach(function(){return i.activeLayer.push(!0)}),this.animatedTiles.push(i),1===this.animatedTiles.length&&(this.active=!0)}},{key:"setRate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===t)null===i?this.rate=e:this.animatedTiles[i].rate=e;else{var n=function(i){i.forEach(function(i){i.index===t&&(i.rate=e)})};null===i?this.animatedTiles.forEach(function(e){n(e.animatedTiles)}):n(this.animatedTiles[i].animatedTiles)}}},{key:"resetRates",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e?(this.rate=1,this.animatedTiles.forEach(function(e){e.rate=1,e.animatedTiles.forEach(function(e){e.rate=1})})):(this.animatedTiles[e].rate=1,this.animatedTiles[e].animatedTiles.forEach(function(e){e.rate=1}))}},{key:"resume",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null===i?this:this.animatedTiles[i];null===t?n.active=!0:(n.activeLayer[t]=!0,n.animatedTiles.forEach(function(i){e.updateLayer(i,i.tiles[t])}))}},{key:"pause",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=null===t?this:this.animatedTiles[t];null===e?i.active=!1:i.activeLayer[e]=!1}},{key:"postUpdate",value:function(e,t){var i=this;if(this.active){var n=t*this.rate*(this.followTimeScale?this.scene.time.timeScale:1);this.animatedTiles.forEach(function(e){if(e.active){var t=n*e.rate;e.animatedTiles.forEach(function(n){if(n.next-=t*n.rate,n.next<0){var a=n.currentFrame,r=n.frames[a].tileid,s=a+1;s>n.frames.length-1&&(s=0),n.next=n.frames[s].duration,n.currentFrame=s,n.tiles.forEach(function(t,a){e.activeLayer[a]&&i.updateLayer(n,t,r)})}})}})}}},{key:"updateLayer",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=[],a=e.frames[e.currentFrame].tileid;t.forEach(function(e){i>-1&&(null===e||e.index!==i)?n.push(e):e.index=a}),n.forEach(function(e){var i=t.indexOf(e);i>-1?t.splice(i,1):console.error("This shouldn't happen. Not at all. Blame Phaser Animated Tiles plugin. You'll be fine though.")})}},{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.shutdown(),this.scene=void 0}},{key:"getAnimatedTiles",value:function(e){var t=this,i=[];return e.tilesets.forEach(function(t){var n=t.tileData;Object.keys(n).forEach(function(a){if(a=parseInt(a),n[a].hasOwnProperty("animation")){var r={index:a+t.firstgid,frames:[],currentFrame:0,tiles:[],rate:1};n[a].animation.forEach(function(e){var i={duration:e.duration,tileid:e.tileid+t.firstgid};r.frames.push(i)}),r.next=r.frames[0].duration,e.layers.forEach(function(e){if("StaticTilemapLayer"===e.tilemapLayer.type)return void r.tiles.push([]);var i=[];e.data.forEach(function(e){e.forEach(function(e){e.index-t.firstgid===a&&i.push(e)})}),r.tiles.push(i)}),i.push(r)}})}),e.layers.forEach(function(e,i){t.activeLayer[i]=!0}),i}},{key:"putTileAt",value:function(e,t,i,n){}},{key:"updateAnimatedTiles",value:function(){var e=null;null===e&&(e=[],this.animatedTiles.forEach(function(t){e.push(t)})),e.forEach(function(e){e.animatedTiles.forEach(function(t){t.tiles.forEach(function(i,n){if("StaticTilemapLayer"!==e.map.layers[n].type)for(var a=0;a<10;a++)for(var r=0;r<10;r++){var s=e.map.layers[n].data[a][r];s.index==t.index&&(-1===i.indexOf(s)&&i.push(s),s.index=t.frames[t.currentFrame].tileid)}})})})}}]),e}();r.register=function(e){e.register("AnimatedTiles",r,"animatedTiles")},e.exports=r}])});