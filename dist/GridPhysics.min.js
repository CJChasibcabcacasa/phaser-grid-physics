!function(i,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("GridPhysics",[],e):"object"==typeof exports?exports.GridPhysics=e():i.GridPhysics=e()}("undefined"!=typeof self?self:this,function(){return function(i){function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return i[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var t={};return e.m=i,e.c=t,e.d=function(i,t,r){e.o(i,t)||Object.defineProperty(i,t,{configurable:!1,enumerable:!0,get:r})},e.n=function(i){var t=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(t,"a",t),t},e.o=function(i,e){return Object.prototype.hasOwnProperty.call(i,e)},e.p="",e(e.s=0)}([function(i,e,t){"use strict";function r(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function i(i,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,r.key,r)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),s=t(1),l=function(i){return i&&i.__esModule?i:{default:i}}(s),a=function(){function i(e){r(this,i),Phaser.Physics.GridPhysics=this,this.scene=e,this.world=new l.default,e.gridPhysics=this,this.systems=e.sys,this.map=null,this.animatedTiles=[],this.rate=1,this.active=!1,this.activeLayer=[],this.followTimeScale=!0,e.sys.settings.isBooted||e.sys.events.once("boot",this.boot,this)}return o(i,[{key:"boot",value:function(){var i=this.systems.events;i.on("update",this.update,this),i.on("postupdate",this.postUpdate,this),i.on("shutdown",this.shutdown,this),i.on("destroy",this.destroy,this)}},{key:"init",value:function(i){var e=this.getAnimatedTiles(i),t={map:i,animatedTiles:e,active:!0,rate:1,activeLayer:[]};i.layers.forEach(function(){return t.activeLayer.push(!0)}),this.animatedTiles.push(t),1===this.animatedTiles.length&&(this.active=!0)}},{key:"setRate",value:function(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===e)null===t?this.rate=i:this.animatedTiles[t].rate=i;else{var r=function(t){t.forEach(function(t){t.index===e&&(t.rate=i)})};null===t?this.animatedTiles.forEach(function(i){r(i.animatedTiles)}):r(this.animatedTiles[t].animatedTiles)}}},{key:"resetRates",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===i?(this.rate=1,this.animatedTiles.forEach(function(i){i.rate=1,i.animatedTiles.forEach(function(i){i.rate=1})})):(this.animatedTiles[i].rate=1,this.animatedTiles[i].animatedTiles.forEach(function(i){i.rate=1}))}},{key:"resume",value:function(){var i=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=null===t?this:this.animatedTiles[t];null===e?r.active=!0:(r.activeLayer[e]=!0,r.animatedTiles.forEach(function(t){i.updateLayer(t,t.tiles[e])}))}},{key:"pause",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=null===e?this:this.animatedTiles[e];null===i?t.active=!1:t.activeLayer[i]=!1}},{key:"postUpdate",value:function(i,e){this.world.bodies.forEach(function(i){i.postUpdate()})}},{key:"update",value:function(i,e){var t=this;if(this.world.update(i,e),this.active){var r=e*this.rate*(this.followTimeScale?this.scene.time.timeScale:1);this.animatedTiles.forEach(function(i){if(i.active){var e=r*i.rate;i.animatedTiles.forEach(function(r){if(r.next-=e*r.rate,r.next<0){var o=r.currentFrame,s=r.frames[o].tileid,l=o+1;l>r.frames.length-1&&(l=0),r.next=r.frames[l].duration,r.currentFrame=l,r.tiles.forEach(function(e,o){i.activeLayer[o]&&t.updateLayer(r,e,s)})}})}})}}},{key:"updateLayer",value:function(i,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=[],o=i.frames[i.currentFrame].tileid;e.forEach(function(i){t>-1&&(null===i||i.index!==t)?r.push(i):i.index=o}),r.forEach(function(i){var t=e.indexOf(i);t>-1?e.splice(t,1):console.error("This shouldn't happen. Not at all. Blame Phaser Animated Tiles plugin. You'll be fine though.")})}},{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.shutdown(),this.scene=void 0}},{key:"getAnimatedTiles",value:function(i){var e=this,t=[];return i.tilesets.forEach(function(e){var r=e.tileData;Object.keys(r).forEach(function(o){if(o=parseInt(o),r[o].hasOwnProperty("animation")){var s={index:o+e.firstgid,frames:[],currentFrame:0,tiles:[],rate:1};r[o].animation.forEach(function(i){var t={duration:i.duration,tileid:i.tileid+e.firstgid};s.frames.push(t)}),s.next=s.frames[0].duration,i.layers.forEach(function(i){if("StaticTilemapLayer"===i.tilemapLayer.type)return void s.tiles.push([]);var t=[];i.data.forEach(function(i){i.forEach(function(i){i.index-e.firstgid===o&&t.push(i)})}),s.tiles.push(t)}),t.push(s)}})}),i.layers.forEach(function(i,t){e.activeLayer[t]=!0}),t}},{key:"putTileAt",value:function(i,e,t,r){}},{key:"updateAnimatedTiles",value:function(){var i=null;null===i&&(i=[],this.animatedTiles.forEach(function(e){i.push(e)})),i.forEach(function(i){i.animatedTiles.forEach(function(e){e.tiles.forEach(function(t,r){if("StaticTilemapLayer"!==i.map.layers[r].type)for(var o=0;o<10;o++)for(var s=0;s<10;s++){var l=i.map.layers[r].data[o][s];l.index==e.index&&(-1===t.indexOf(l)&&t.push(l),l.index=e.frames[e.currentFrame].tileid)}})})})}}]),i}();a.register=function(i){i.register("GridPhysics",a,"GridPhysics")},i.exports=a},function(i,e,t){"use strict";function r(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function i(i,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,r.key,r)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),s=t(2),l=function(i){return i&&i.__esModule?i:{default:i}}(s),a=function(){function i(e){r(this,i),this.cnt=0,this.gridSize=new Phaser.Geom.Point(8),this.shadowSize=0,this.lockBodies=!1,this.bodies=[],this.tilemaplayers=[],this.tileGridRatio=new Phaser.Geom.Point(-1,-1),console.log(this.tileGridRatio),this._pushChain=[],this.map=null,this.debugGfx={graphics:null,update:!0,grid:{active:!1,wasActive:!1,data:null},path:{active:!1,wasActive:!1,data:null},pathCollision:{active:!1,wasActive:!1},collision:{active:!1,wasActive:!1,data:null}},window.debugGfx=this.debugGfx,this.turnbased=!1,this.turn=0,this.que=[],this.collisionMap=null}return o(i,[{key:"enable",value:function(i){switch(i.type){case"Sprite":i.body=new l.default(i),this.bodies.push(i.body);break;case"StaticTilemapLayer":return this.tilemaplayers.push(i),i.setOrigin(0,0),-1===this.tileGridRatio.x&&this.tileGridRatio.setTo(i.collisionWidth/this.gridSize.x,i.collisionHeight/this.gridSize.y),void this.updateBorders(i);default:i.hasOwnProperty&&(this.map=i)}}},{key:"updateBorders",value:function(i){console.log("UPDATE BLOCKED",i);for(var e=i.layer.data,t=0;t<e.length;t++){console.log("y"+t);for(var r=0;r<e[t].length;r++){var o=e[t][r];o.borderUp&&(o.collideUp=!0,e[t-1][r].collideDown=!0),o.borderDown&&(o.collideDown=!0,e[t+1][r].collideUp=!0),o.borderLeft&&(o.collideLeft=!0,e[t][r-1].collideRight=!0),o.borderRight&&(o.collideRight=!0,e[t][r+1].collideLeft=!0)}}}},{key:"addToQue",value:function(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!i.hasOwnProperty("myTurn")&&i.hasOwnProperty("body")&&(i=i.body),0===e&&(e=i.reload>0?i.reload:1),this.que.length<2*e)for(var t=0;t<2*e;t++)this.que.push(null);for(var r=2*e;null!=this.que[r];)r++;this.que.splice(r,0,i)}},{key:"nextTurn",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;null!=i&&(i.myTurn=!1,i.turns++,this.turn++,this.addToQue(i,e));for(var t=null;null===t&&this.que.length>0;)t=this.que.shift(0);if(null===t)return console.error("EMPTY QUE!"),!1;t.myTurn=!0}},{key:"update",value:function(i,e){this.turnMade=!1;var t=e/1e3,r=!0,o=!1,s=void 0;try{for(var l,a=this.bodies[Symbol.iterator]();!(r=(l=a.next()).done);r=!0)for(var n=l.value,h={x:n.sprite.x,y:n.sprite.y},d=["x","y"],c=0;c<d.length;c++){var u=d[c];0!==n.velocity[u]?(n.gridPosition[u]*n.world.gridSize[u]!=n.sprite[u]&&(n.sprite[u]+=n.velocity[u]*t,h[u]=n.sprite[u]+n.velocity[u]*t),n.velocity[u]>0&&h[u]>n.gridPosition[u]*n.world.gridSize[u]&&(n.isLocked[u]=!1),n.velocity[u]<0&&h[u]<n.gridPosition[u]*n.world.gridSize[u]&&(n.isLocked[u]=!1),n.isLocked.x||n.isLocked.y||!this.turnbased||n.setVelocity(0)):n.sprite[u]=n.gridPosition[u]*n.world.gridSize[u]}}catch(i){o=!0,s=i}finally{try{!r&&a.return&&a.return()}finally{if(o)throw s}}this.debugGfx.update&&this.renderDebug()}},{key:"renderDebug",value:function(){var i=this.debugGfx;if(i.grid.active!=i.grid.wasActive||i.path.active!=i.path.wasActive||i.pathCollision.active!=i.pathCollision.wasActive||i.collision.active!=i.collision.wasActive){i.graphics?i.graphics.clear():i.graphics=game.add.graphics(0,0),i.grid.active&&this.renderGrid(),i.path.active&&this.renderPath(),i.pathCollision.active&&this.renderPathCollision(),i.collision.active&&this.renderCollision();for(var e=["grid","collision","path","pathCollision"],t=0;t<e.length;t++){var r=e[t];i[r].wasActive=i[r].active}i.grid.active||i.path.active||i.pathCollision.active||i.collision.active?i.graphics.alpha=1:i.graphics.alpha=0}}},{key:"renderGrid",value:function(){var i=this.debugGfx.graphics;i.lineStyle(1,0,.2);for(var e=0;e<this.game.width/this.gridSize.x;e++)i.moveTo(e*this.gridSize.x,0),i.lineTo(e*this.gridSize.x,this.game.height);for(var t=0;t<this.game.height/this.gridSize.y;t++)i.moveTo(0,t*this.gridSize.y),i.lineTo(this.game.width,t*this.gridSize.y)}},{key:"renderCollision",value:function(){var i=this.debugGfx.graphics;i.lineStyle(0,65280,0);var e=!0,t=!1,r=void 0;try{for(var o,s=this.tilemaplayers[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){var l=o.value;for(var a in l.layer.data)for(var n in l.layer.data[a]){var h=l.layer.data[a][n];h.collides&&(i.beginFill(16711680,.5),i.drawRect(n*h.width+1,a*h.height+1,h.width-2,h.height-2),i.endFill())}}}catch(i){t=!0,r=i}finally{try{!e&&s.return&&s.return()}finally{if(t)throw r}}}},{key:"renderPathCollision",value:function(i){if(i)return this.debugGfx.pathCollision.data=i,void(this.debugGfx.pathCollision.wasActive=!1);if(this.debugGfx.pathCollision.data&&0!==this.debugGfx.pathCollision.data.length)for(var e=this.debugGfx.graphics,t=this.debugGfx.pathCollision.data,r=0;r<t.length;r++){e.lineStyle(1,16711680,.3);for(var o=0;o<t[0].length;o++)0!=t[r][o]&&(t[r][o]<2?e.beginFill(16724736,.4):4==t[r][o]?e.beginFill(255,.4):e.beginFill(16724991,.4),e.drawRect(o*this.gridSize.x,r*this.gridSize.y,this.gridSize.x,this.gridSize.y),e.endFill())}}},{key:"renderPath",value:function(i){if(i)return this.debugGfx.path.data=i,void(this.debugGfx.path.wasActive=!1);if(this.debugGfx.path.data&&0!==this.debugGfx.path.data.length){var e=this.debugGfx.graphics,t=this.debugGfx.path.data;e.lineStyle(1,65280,.5);var r=!0,o=!1,s=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var n=l.value;e.beginFill(65280,.4),e.drawRect(n.x*this.gridSize.x,n.y*this.gridSize.y,this.gridSize.x,this.gridSize.y)}}catch(i){o=!0,s=i}finally{try{!r&&a.return&&a.return()}finally{if(o)throw s}}var h=t[t.length-1];e.beginFill(16724736,.7),e.drawRect(h.x*this.gridSize.x,h.y*this.gridSize.y,this.gridSize.x,this.gridSize.y),e.endFill()}}},{key:"resetCollisionLayer",value:function(){for(var i=this.map,e=i.getLayerIndex("gridPhysicsCollision"),t=void 0,r=0;r<i.layers[e].width;r++)for(var o=0;o<i.layers[e].height;o++)i.putTileAt(1,r,o,"gridPhysicsCollision"),t=i.getTileAt(r,o,"gridPhysicsCollision"),t.collideUp=!1,t.collideRight=!1,t.collideDown=!1,t.collideLeft=!1}},{key:"addToLayerToCollision",value:function(i){console.log("WHAT");var e=i.tilemap,t=e.getLayerIndex("gridPhysicsCollision");console.log("COL",i);var r=void 0,o=void 0;if(o=e.getTileAt(1,0,i),console.log("tile",o.index),!t){var s=e.createBlankDynamicLayer("gridPhysicsCollision",e.width,e.height,e.tileWidth,e.tileHeight);t=e.getLayerIndex("gridPhysicsCollision"),s.visible=!1,this.resetCollisionLayer()}console.log(e),o=e.getTileAt(1,0,i),console.log("tile",o.index),console.log("layerindex",i.layerIndex),console.log("asa",i);for(var l=0;l<i.width;l++){console.log(l);for(var a=0;a<i.height;a++){var n=e.getTileAt(l,a,i);null!==n&&(21!==n.index?console.log(n):console.log("."),r=e.getTileAt(l,a,"gridPhysicsCollision"),r.collideUp=!!n.collideUp||r.collideUp,r.collideRight=!!n.collideRight||r.collideRight,r.collideDown=!!n.collideDown||r.collideDown,r.collideLeft=!!n.collideLeft||r.collideLeft)}}console.log(e.layers[t])}}]),i}();e.default=a},function(i,e,t){"use strict";function r(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function i(i,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,r.key,r)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),s=function(){function i(e){r(this,i),this.sprite=e,this.world=Phaser.Physics.GridPhysics.world,this.gridPosition=new Phaser.Geom.Point(0,0),this.width=Math.round(e.width/this.world.gridSize.x),this.height=Math.round(e.height/this.world.gridSize.y),this.velocity=new Phaser.Geom.Point(0,0),this._desiredVelocity=new Phaser.Geom.Point(0,0),this.mass=1,this.strength=-1,this.pushLimit=-1,this.struggle=0,this.struggling=!1,this.facing=Phaser.NONE,this.immovable=!1,this.collidable=!0,this.collideWorldBounds=!1,this.isMoving={x:!1,y:!1,any:!1},this.moveTo={active:!1,path:[],next:null,recalc:0},this.magnetism={dragItself:!1,weakenByFactor:1,maxRange:1,top:{active:!1,power:0,pole:null,attractedTo:null,attractedToAll:!1},right:{active:!1,power:0,pole:null,attractedTo:null,attractedToAll:!1},bottom:{active:!1,power:0,pole:null,attractedTo:null,attractedToAll:!1},left:{active:!1,power:0,pole:null,attractedTo:null,attractedToAll:!1}},this.cojoinedBodies=[],this._shadow=new Phaser.Geom.Point(0,0),this.isLocked={x:!1,y:!1,any:!1},this._longPress=0,this.activeSteps=0,this.passiveSteps=0,this.myTurn=!1,this.turns=0,this.reload=1,this.snapToGrid()}return o(i,[{key:"snapToGrid",value:function(){this.gridPosition={x:Math.round(this.sprite.x/this.world.gridSize.x),y:Math.round(this.sprite.y/this.world.gridSize.y)},this.sprite.x=this.world.gridSize.x*this.gridPosition.x,this.sprite.y=this.world.gridSize.y*this.gridPosition.y}},{key:"collideTilemap",value:function(i,e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:this.gridPosition.x+i,y:this.gridPosition.y+e},o=this.width,s=this.height;0!==i?(o=1,i>0&&(r.x+=this.width-1)):0!==e&&(s=1,e>0&&(r.y+=this.height-1));for(var l={x:2,y:2},a=r.x;a<r.x+o;a++)for(var n=r.y;n<r.y+s;n++){var h=!1,d=!0,c=!1,u=void 0;try{for(var f,y=this.world.tilemaplayers[Symbol.iterator]();!(d=(f=y.next()).done);d=!0){var v=f.value;v.collisionHeight=16,v.collisionWidth=16;var g=Math.floor(n*this.world.gridSize.y/v.collisionHeight),p=void 0;if(g<0||g>v.layer.data.length-1){if(this.collideWorldBounds)return!0}else if((p=Math.floor(a*this.world.gridSize.x/v.collisionWidth))<0||g>v.layer.data[g].length-1){if(this.collideWorldBounds)return!0}else{var x=v.layer.data[g][p];if(null!==x&&-1!==x.index){if(x.collideRight&&x.collideLeft&&x.collideDown&&x.collideUp){h=!0;break}if(i<0&&x.collideRight){console.log("Collide RIGHT",x),h=!0;break}if(i>0&&x.collideLeft){console.log("Collide KEFT",x),h=!0;break}if(e<0&&x.collideDown){console.log("Collide DOWN",x),h=!0;break}if(e>0&&x.collideUp){console.log("Collide UP",x),h=!0;break}if(0!=i){if(x.borderUp&&r.y<x.y*l.y){h=!0;break}if(x.borderDown&&r.y+s>x.y*l.y){h=!0;break}}if(0!=e){if(x.borderLeft&&r.x<x.x*l.x){h=!0;break}if(x.borderRight&&r.x+o>x.x*l.x){h=!0;break}}}}}}catch(i){c=!0,u=i}finally{try{!d&&y.return&&y.return()}finally{if(c)throw u}}if(h){if(t){if(0!==i){if(!this.collideTilemap(i,e-1))return{dx:i,dy:e-1};if(!this.collideTilemap(i,e+1))return{dx:i,dy:e+1}}if(0!==e){if(!this.collideTilemap(i-1,e))return{dx:i-1,dy:e};if(!this.collideTilemap(i+1,e))return{dx:i+1,dy:e}}}return{dx:0,dy:0}}}return!1}},{key:"setVelocity",value:function(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=null!==e?e:i,0===i&&0!==e?this._longpress=1:0===e&&0!==i&&(this._longpress=0),this._desiredVelocity={x:i,y:e}}},{key:"_intersectRect",value:function(i,e){return!(e.x>=i.x+i.width||e.x+e.width<=i.x||e.y>=i.y+i.height||e.y+e.height<=i.y)}},{key:"testMove",value:function(i,e){if(!this.collidable)return!0;if(this.collideTilemap(i,e))return!1;var t=!0,r=!1,o=void 0;try{for(var s,l=this.world.bodies[Symbol.iterator]();!(t=(s=l.next()).done);t=!0){var a=s.value;if(this!==a&&a.collidable&&this._intersectRect({x:this.gridPosition.x+i,y:this.gridPosition.y+e,width:this.width,height:this.height},{x:a.gridPosition.x,y:a.gridPosition.y,width:a.width,height:a.height})){if(a.immovable)return!1;if(-1===this.world._pushChain.indexOf(a)&&(this.world._pushChain.push(a),!a.testMove(i,e)))return!1}}}catch(i){r=!0,o=i}finally{try{!t&&l.return&&l.return()}finally{if(r)throw o}}return!0}},{key:"postUpdate",value:function(){if(!this.isLocked.x&&!this.isLocked.y){if(this.moveTo.active){this._desiredVelocity={x:0,y:0};var i=this.moveTo.path[this.moveTo.next];i.x<this.gridPosition.x?this._desiredVelocity.x=-100:i.x>this.gridPosition.x?this._desiredVelocity.x=100:i.y<this.gridPosition.y?this._desiredVelocity.y=-100:i.y>this.gridPosition.y&&(this._desiredVelocity.y=100),this.moveTo.next++,this.moveTo.next>this.moveTo.path.length-1&&(this.moveTo.active=!1)}if(this.isMoving={x:!1,y:!1,any:!1},0===this._desiredVelocity.x&&0===this._desiredVelocity.y)return this.velocity.x=0,this.velocity.y=0,void(this.struggling=!1);this.world._pushChain=[];for(var e=!0,t={},r=["x","y"],o=0;o<r.length;o++){var s=r[o];t[s]=0===this._desiredVelocity[s]?0:this._desiredVelocity[s]>0?1:-1}for(var l=[0,1],a=0;a<l.length;a++){if(0===l[a]){if(0===t.x)continue;if(!this.testMove(t.x,0)){e=!1;break}e=!0}else{if(0===t.y)continue;if(!this.testMove(0,t.y)){e=!1;break}e=!0}}if(this.strength>-1||this.struggle>1){var n=0,h=!0,d=!1,c=void 0;try{for(var u,f=this.world._pushChain[Symbol.iterator]();!(h=(u=f.next()).done);h=!0){n+=u.value.mass}}catch(i){d=!0,c=i}finally{try{!h&&f.return&&f.return()}finally{if(d)throw c}}this.strength>-1&&n>this.strength&&(e=!1),this.struggle>1&&n>0&&(this._desiredVelocity.x=this._desiredVelocity.x/(n*this.struggle),this._desiredVelocity.y=this._desiredVelocity.y/(n*this.struggle))}if(this.pushLimit>-1&&this.world._pushChain.length>this.pushLimit&&(e=!1),!e)return 0===this._desiredVelocity.x&&0===this._desiredVelocity.y||(this.struggling=!0),this._desiredVelocity.x>0?this.facing=Phaser.RIGHT:this._desiredVelocity.x<0?this.facing=Phaser.LEFT:this._desiredVelocity.y<0?this.facing=Phaser.UP:this._desiredVelocity.y>0&&(this.facing=Phaser.DOWN),this.velocity.x=0,this.velocity.y=0,this._shadow.x=0,void(this._shadow.y=0);for(var y=["x","y"],v=0;v<y.length;v++){var g=y[v];if(this.velocity[g]=this._desiredVelocity[g],this._shadow[g]=0,0!=this.velocity[g]){this.gridPosition[g]+=this.velocity[g]>0?1:-1,this.isLocked[g]=!0,this._shadow[g]=this.velocity[g]<0?1:-1;var p=!0,x=!1,m=void 0;try{for(var w,b=this.world._pushChain[Symbol.iterator]();!(p=(w=b.next()).done);p=!0){var T=w.value;T.passiveSteps++,T.snapToGrid(),T.velocity[g]=this._desiredVelocity[g],T.gridPosition[g]+=T.velocity[g]>0?1:-1,T.isLocked[g]=!0}}catch(i){x=!0,m=i}finally{try{!p&&b.return&&b.return()}finally{if(x)throw m}}}}this.velocity.x>0?this.facing=Phaser.RIGHT:this.velocity.x<0?this.facing=Phaser.LEFT:this.velocity.y<0?this.facing=Phaser.UP:this.velocity.y>0&&(this.facing=Phaser.DOWN),0!==this.velocity.x&&(this.isMoving.x=!0),0!==this.velocity.y&&(this.isMoving.y=!0),this.isMoving.any=!0,this.struggling=!1,this.baseVelocity=75,this.activeSteps++}}}]),i}();e.default=s}])});